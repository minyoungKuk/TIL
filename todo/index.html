<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Todo List</title>

    <link rel="stylesheet" href="../css/reset.css" />
    <link rel="stylesheet" href="../css/style.css" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script type="module">
      // Firebase SDK ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°€ì ¸ì˜¤ê¸°
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
      import {
        getFirestore,
        collection,
        addDoc,
        getDocs,
        updateDoc,
        doc,
        deleteDoc,
      } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

      // Firebase êµ¬ì„± ì •ë³´ ì„¤ì •
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyDIIxbpgYkbvH-EX-RDdrOX8rdziEBwSHA",
        authDomain: "sparta-ccbfe.firebaseapp.com",
        projectId: "sparta-ccbfe",
        storageBucket: "sparta-ccbfe.appspot.com",
        messagingSenderId: "137119719673",
        appId: "1:137119719673:web:4aa90eb4c5e3d5f4a18228",
        measurementId: "G-B8P5ZXYR0S",
      };

      // Firebase ì¸ìŠ¤í„´ìŠ¤ ì´ˆê¸°í™”
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      $("#listAddBtn").click(async function () {
        let list = $("#todolist").val();
        let listDate = $("#todolistdate").val();

        let doc = {
          list: list,
          listDate: listDate,
          done: false,
        };

        if (list === "") {
          alert(" í•´ì•¼ í•  ì¼ì„ ì ì–´ì£¼ì„¸ìš” ğŸ¥¹");
        } else if (listDate === "") {
          alert(" ë§ˆê°ê¸°í•œì„ ë„£ì–´ì£¼ì„¸ìš” ğŸ¥¹");
        } else {
          await addDoc(collection(db, "todolist"), doc);
          alert("í•  ì¼ì„ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€í•˜ì˜€ìŠµë‹ˆë‹¤.");
          window.location.reload();
        }
      });

      $(document).ready(async function () {
        let docs = await getDocs(collection(db, "todolist"));
        docs.forEach((doc) => {
          let row = doc.data();

          let list = row["list"];
          let listDate = row["listDate"];
          let isDone = row["done"] || false;

          let temp_html = `
          <div class="lists ${isDone ? "done" : ""}" data-id="${doc.id}">
            <div class="txt" id="openModal">${list}<span>${listDate}ê¹Œì§€ ì™„ë£Œí•´ì•¼ í•©ë‹ˆë‹¤.</span></div>
            <div class="chkbox">
              <div class="outer-circle">
                <div class="inner-circle"></div>
              </div>
            </div>
          </div>
        `;

          $(".myTodoList").append(temp_html);
        });
      });

      $(document).on("click", ".myTodoList .chkbox", async function () {
        $(this).closest(".lists").toggleClass("done");

        // í•´ë‹¹ í•  ì¼ì˜ ID ê°€ì ¸ì˜¤ê¸°
        let docId = $(this).closest(".lists").attr("data-id");

        // í•´ë‹¹ í•  ì¼ì˜ ìƒíƒœ ê°€ì ¸ì˜¤ê¸°
        let isDone = $(this).closest(".lists").hasClass("done");

        // Firestoreì—ì„œ í•´ë‹¹ í•  ì¼ ë¬¸ì„œ ê°€ì ¸ì˜¤ê¸°
        let docRef = doc(db, "todolist", docId);

        // í•´ë‹¹ í•  ì¼ ë¬¸ì„œ ì—…ë°ì´íŠ¸
        await updateDoc(docRef, {
          done: isDone,
        });
      });

      $(document).on("click", "#openModal", async function () {
        // í´ë¦­í•œ ë¦¬ìŠ¤íŠ¸  IDê°’ ê°€ì ¸ì˜¤ê¸°
        let docId = $(this).closest(".lists").attr("data-id");
        // ì‚­ì œ ë²„íŠ¼ì— í•´ë‹¹ ë¦¬ìŠ¤íŠ¸ ID ì €ì¥
        $(".modal-content .delete").attr("data-id", docId);

        $("#modal").fadeIn();
        $("body").css("background-color", "rgba(0, 0, 0, 0.5)");
      });

      $(document).on("click", ".modal-content .delete", async function () {
        let docId = $(this).attr("data-id");
        await deleteDoc(doc(db, "todolist", docId));
        $(`.lists[data-id="${docId}"]`).remove();
        $("#modal").fadeOut();
        $("body").css("background-color", "#fff");
      });
      $(".close").on("click", (e) => {
        // $('#modal').css('display', 'none')
        $("#modal").fadeOut();
        $("body").css("background-color", "#fff");
      });
    </script>
  </head>
  <body>
    <div class="wrap">
      <div class="header">
        <a href="https://minyoungkuk.github.io/TIL/" class="home"
          >Minyoung's diary</a
        >
        <nav>
          <ul>
            <li><a href="../index.html">TIL</a></li>
            <li><a href="">ê¸°ìˆ ì¼ì§€</a></li>
            <li><a href="">ì°¸ê³ ìë£Œ</a></li>
            <li class="active"><a href="./index.html">Todo</a></li>
          </ul>
        </nav>
      </div>

      <div class="main">
        <h2>Todo List - <span>ê¹Œë¨¹ì§€ë§ê³  í•´ì•¼ í•  ì¼ ì²´í¬ë¦¬ìŠ¤íŠ¸ ğŸ’Œ</span></h2>
        <div class="myListBox">
          <div>
            <input
              type="text"
              id="todolist"
              style="width: 500px"
              placeholder="í•´ì•¼í•  ì¼ì„ ì¶”ê°€í•´ ì£¼ì„¸ìš”."
            />
            <input type="date" id="todolistdate" />
          </div>

          <button id="listAddBtn">í• ì¼ ì¶”ê°€</button>
        </div>

        <div class="myTodoList">
          <!-- <div class="lists">
            <div class="txt">Read an article <span>2021.01.02</span></div>
            <div class="chkbox">
              <div class="outer-circle">
                <div class="inner-circle"></div>
              </div>
            </div>
          </div>
          <div class="lists done">
            <div class="txt">
              Being QA for the project <span>2021.01.02</span>
            </div>
            <div class="chkbox">
              <div class="outer-circle">
                <div class="inner-circle"></div>
              </div>
            </div>
          </div> -->
        </div>
      </div>

      <div class="footer">
        <ul>
          <li>@ë‚´ì¼ë°°ì›€ìº í”„</li>
          <li>@React 5ê¸° - êµ­ë¯¼ì˜</li>
        </ul>
      </div>

      <div id="modal" class="modal_wrap">
        <div class="modal-content">
          <p>í´ë¦­í•˜ì‹  ë¦¬ìŠ¤íŠ¸ë¥¼ ëª©ë¡ì—ì„œ ì‚­ì œí• ê¹Œìš”?</p>
          <div class="btns">
            <button class="btn delete red">ì‚­ì œ</button>
            <button class="btn close blue">ì°½ ë‹«ê¸°</button>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
